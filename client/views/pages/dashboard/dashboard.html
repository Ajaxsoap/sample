<template name="Dashboard">
  {{# Layout template="pageHeading" }}
    <span class="fa fa-check"></span>&nbsp;Welcome {{ currentUser.profile.name }}
  {{/ Layout }}
  {{#if Template.subscriptionsReady}}
  {{# if userHasPermission 'showDashboard'}}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.index' }}" class="label label-primary">Enrollments</a></span>
                        <h5>Enrollments</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'enrollmentsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.create' }}" class="label label-primary"><span class="fa fa-plus"></span>&nbsp;Add Enrollee</a></span>
                        <small>Total Enrollments</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.index' }}" class="label label-info">Claims</a></span>
                        <h5>Claims</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'claimsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.create' }}" class="label label-info"><span class="fa fa-plus"></span>&nbsp;Add Claims</a></span>
                        <small>Total Claims</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
              <div class="widget navy-bg no-padding">
                <div class="p-m">
                  <h1 class="m-xs">Php {{ lifePremium }}</h1>
                  <h3 class="font-bold no-margins">
                    Total Life Premium
                  </h3>
                  <small>Income from Life product.</small>
                </div>
              </div>
            </div>
            <div class="col-lg-3">
              <div class="widget yellow-bg no-padding">
                <div class="p-m">
                  <h1 class="m-xs">Php</h1>
                  <h3 class="font-bold no-margins">
                    Total Non-Life Premium
                  </h3>
                  <small>Income from Non-Life.</small>
                </div>
              </div>
            </div>
          </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="ibox float-e-margins">
              <div class="ibox-content">
                <div>
                  <span class="pull-right text-right">
                    <strong>Legend:</strong>&nbsp;<button class='btn btn-xs btn-default'>Claims</button>
                    &nbsp;<button class='btn btn-xs btn-primary'>Enrollments</button>
                    </span>
                  <h1 class="m-b-xs">Summary of Enrollments and Claims</h1>
                </div>
                <div>
                  <canvas id="lineChart" height="70"></canvas>
                </div>
                <div class="m-t-md">
                  <small class="pull-right">
                    <i class="fa fa-clock-o"> </i>
                    Updated on {{ updated }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="ibox-title">
              <h5>Enrollments</h5>
            </div>
            <div class="ibox-content">
              {{> enolledTable }}
            </div>
          </div>
        </div>
        <p>
          &nbsp;
        </p>
        <div class="row">
          <div class="col-lg-12">
            <div class="ibox-title">
              <h5>Claims</h5>
            </div>
            <div class="ibox-content">
              {{> claimedTable }}
            </div>
          </div>
        </div>
    </div>
    {{/if}}

    {{# if userHasPermission 'showHQDashboard'}}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.index' }}" class="label label-primary">Enrollments</a></span>
                        <h5>Enrollments</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'enrollmentsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.create' }}" class="label label-primary"><span class="fa fa-plus"></span>&nbsp;Add Enrollee</a></span>
                        <small>Total Enrollments</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.index' }}" class="label label-info">Claims</a></span>
                        <h5>Claims</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'claimsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.create' }}" class="label label-info"><span class="fa fa-plus"></span>&nbsp;Add Claims</a></span>
                        <small>Total Claims</small>
                    </div>
                </div>
            </div>

        </div>
        <div class="row">
          <div class="col-lg-6">
            <div class="ibox-title">
              Enrollments per branch
            </div>
            <div class="ibox-content">

              {{> companyEnrolleesDashboard }}
            </div>
          </div>
          <div class="col-lg-6">
            <div class="ibox-title">
              Claims per branch
            </div>
            <div class="ibox-content">
              {{> companyClaimsDashboard }}
            </div>
          </div>
        </div>
    </div>
    {{/if}}

    {{# if userHasPermission 'showBranchDashboard' }}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.index' }}" class="label label-primary">Enrollments</a></span>
                        <h5>Enrollments</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'enrollmentsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.create' }}" class="label label-primary"><span class="fa fa-plus"></span>&nbsp;Add Enrollee</a></span>
                        <small>Total Enrollments</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.index' }}" class="label label-info">Claims</a></span>
                        <h5>Claims</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'claimsCount' }}</h1>
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.create' }}" class="label label-info"><span class="fa fa-plus"></span>&nbsp;Add Claims</a></span>
                        <small>Total Claims</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{/if}}
    {{# if userHasPermission 'showInsurerDashboard' }}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.enrollments.index' }}" class="label label-primary">Enrollments</a></span>
                        <h5>Enrollments</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'enrollmentsCount' }}</h1>
                        <small>Total Enrollments</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="pull-right"><a href="{{ RouterLayerPathFor 'collections.claims.index' }}" class="label label-info">Claims</a></span>
                        <h5>Claims</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ getPublishedCount 'claimsCount' }}</h1>
                        <small>Total Claims</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{/if}}
    {{ else }}
      loading...
    {{/if}}
</template>

<template name="enolledTable">
  <div id="data">
    <table id="enrollmentsTable" class="table table-striped tablesorter table-responsive">
      <thead>
        <tr>
          <th>Date Enrolled</th>
          <th>Name</th>
          <th>Children</th>
          <th>Date of Birth</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Phone</th>
          <th>Address</th>
          <th>City</th>
          <th>Beneficiary</th>
          <th>Marital status</th>
          <th>Spouse Name</th>
          <th>Parent</th>
          <th>Siblings</th>
          <th>Effectivity Date</th>
          <th>Maturity Date</th>
          <th>Company</th>
          <th>Branch</th>
          <th>Month Left</th>
          <th>Loan Cycle</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th>Date Enrolled</th>
          <th>Name</th>
          <th>Children</th>
          <th>Date of Birth</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Phone</th>
          <th>Address</th>
          <th>City</th>
          <th>Beneficiary</th>
          <th>Marital status</th>
          <th>Spouse Name</th>
          <th>Parent</th>
          <th>Siblings</th>
          <th>Effectivity Date</th>
          <th>Maturity Date</th>
          <th>Company</th>
          <th>Branch</th>
          <th>Month Left</th>
          <th>Loan Cycle</th>
        </tr>
      </tfoot>
      <tbody>
        {{#each enrollmentsList}}
        <tr>
          <td>{{ datelll createdAt }}</td>
          <td>{{ fullName }}</td>
          <td>{{> children }}</td>
          <td>{{ datell birthdate }}</td>
          <td>{{ ageOfEnrollee }}</td>
          <td>{{ gender }}</td>
          <td>{{ phone }}</td>
          <td>{{ address }}</td>
          <td>{{ city }}</td>
          <td>{{> beneficiaries }}</td>
          <td>{{ maritalStatus }}</td>
          <td>{{ spouseName }}</td>
          <td>{{> parents }}</td>
          <td>{{> siblings }}</td>
          <td>{{ datell effectivityDate }}</td>
          <td>{{ datell maturityDate }}</td>
          <td>{{ companyName company }}</td>
          <td>{{ branchName branch }}</td>
          <td>{{ monthCount }}</td>
          <td>{{ loanCycle }}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  <hr>
  <div class="row">
    <div class="col col-md-6">
      <span class="btn btn-primary">Total of <strong>{{ getPublishedCount 'enrollmentsCount' }}</strong> enrollments</span>
    </div>
  </div>
</template>

<template name="children">
  {{# each children }}
    <tr>
      <td>
        {{ name }},
      </td>
    </tr>
  {{/each}}
</template>
<template name="beneficiaries">
  {{# each beneficiary }}
    <tr>
      <td>
        {{ name }},
      </td>
    </tr>
  {{/each}}
</template>
<template name="parents">
  {{# each parent }}
    <tr>
      <td>
        {{ name }},
      </td>
    </tr>
  {{/each}}
</template>
<template name="siblings">
  {{# each sibling }}
    <tr>
      <td>
        {{ name }},
      </td>
    </tr>
  {{/each}}
</template>

<template name="claimedTable">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-content">
          <div>
            <span class="pull-right text-right">
              <strong>Legend:</strong>&nbsp;<button class='btn btn-xs btn-default'>Total Number of Deaths</button>
              </span>
            <h1 class="m-b-xs">Claims</h1>
          </div>
          <div>
            <canvas id="lineClaimChart" height="70"></canvas>
          </div>
          <div class="m-t-md">
            <small class="pull-right">
              <i class="fa fa-clock-o"> </i>
              Updated on {{ updated }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr>
  <div id="data">
    <table id="claimantTable" class="table table-striped tablesorter">
      <thead>
        <tr>
          <th>Date Filed</th>
          <th>Days Processed</th>
          <th>Reference Number</th>
          <th>Insured Name</th>
          <th>Client Type</th>
          <th>Status</th>
          <th>Amount Paid</th>
          <th>Cause of Death</th>
          <th>Medical</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th>Date Filed</th>
          <th>Days Processed</th>
          <th>Reference Number</th>
          <th>Insured Name</th>
          <th>Client Type</th>
          <th>Status</th>
          <th>Amount Paid</th>
          <th>Cause of Death</th>
          <th>Medical</th>
        </tr>
      </tfoot>
      <tbody>
        {{#each claimsList }}
        <tr>
          <td>{{ filedDate dateFiled }}</td>
          <td>{{ daysProcessed }}</td>
          <td>{{ claimNumber }}</td>
          <td>{{ insuredName enrollmentId }}</td>
          <td>{{ clientType }}</td>
          <td>{{> claimedStatus }}</td>
          <td>{{ ammountPaid }}</td>
          <td>{{ causeOfDeath }}</td>
          <td>{{ medical }}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  <hr>
  <div class="row">
    <div class="col col-md-6">
      <span class="btn btn-info">Total of <strong>{{ getPublishedCount 'claimsCount' }}</strong> claims</span>
    </div>
  </div>
</template>
<template name="claimedStatus">
  {{#if statusPending}}
    <label class="btn btn-warning btn-xs">{{ status }}</label>
  {{/if}}

  {{#if statusApproved}}
    <label class="btn btn-primary btn-xs">{{ status }}</label>
  {{/if}}

  {{#if statusDenied}}
    <label class="btn btn-danger btn-xs">{{ status }}</label>
  {{/if}}
</template>
<template name="countMonth">
  <label class="label label-primary"></label>
</template>

<template name="companyEnrolleesDashboard">
  <table id="branchEnrolleeTable" class=" table table-striped tablesorter">
    <thead>
      <tr>
        <th>Branches</th>
        <th>Total number of Enrollments per Branch</th>
      </tr>
    </thead>
    <tbody>
        {{> branchList }}
    </tbody>
  </table>
</template>
<template name="branchList">
  {{#each branchesEnrolleeCount }}
    <tr>
      <td>{{ branchName _id }}</td>
      <td>{{ count }}</td>
    </tr>
  {{/each}}
</template>
<template name="companyClaimsDashboard">
  <table id="branchClaimTable" class=" table table-striped tablesorter">
    <thead>
      <tr>
        <th>Branches</th>
        <th>Total number of Claims per branch</th>
      </tr>
    </thead>
    <tbody>
        {{> claimList }}
    </tbody>
  </table>
</template>
<template name="claimList">
  {{#each branchClaimsCounts }}
  <tr>
    <td>{{ branchName _id }}</td>
    <td>{{ count }}</td>
  </tr>
  {{/each}}
</template>
